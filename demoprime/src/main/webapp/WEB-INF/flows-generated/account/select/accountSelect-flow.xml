<?xml version="1.0" encoding="UTF-8"?>
<!--
 ! (c) Copyright 2005-2012 JAXIO, www.jaxio.com
 ! Source code generated by Celerio, a Jaxio product
 ! Want to use Celerio within your company? email us at info@jaxio.com
 ! Follow us on twitter: @springfuse
 ! Template pack-jsf2-primefaces-sd:src/main/webapp/WEB-INF/flows/select/selectFlow.e.vm.xml
-->
<flow xmlns="http://www.springframework.org/schema/webflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
	<persistence-context />
    
    <!-- * sub: opened from another edit flow, generally to select the target entity of a many-to-one association -->
	<input name="sub" type="boolean" value="flowScope.sub"/>

	<decision-state id="selectChoice">
		<if test="sub" then="accountSubSelect" else="accountSelect" />
	</decision-state>

	<view-state id="accountSelect" parent="#accountSelectCommon">
        <on-render>
            <evaluate expression="flowsMenuHandler.updateMenu(flowRequestContext,'select')" /> 
        </on-render>    
	</view-state>

    <view-state id="accountSubSelect" parent="#accountSelectCommon">
    </view-state>

    <view-state id="accountSelectCommon">
        <on-entry>
            <!-- Force search to get some data to present to the user immediately -->
            <evaluate expression="accountSearchForm.lazyDataModel" result="viewScope.accounts" />
        </on-entry>
        <transition on="search">
            <evaluate expression="accountSearchForm.lazyDataModel" result="viewScope.accounts" />
        </transition>        
    </view-state>
    
	<!-- ========== -->
	<!-- END STATES -->
	<!-- ========== -->
	<!-- Default end state -->
	<end-state id="accountSelected">
		<output name="accountSelected" value="accountSelected" />
	</end-state>
	<!-- End state for menu actions -->
	<end-state id="new" />
	<end-state id="quit" />
	<end-state id="cancel" />
    <!-- see the SimpleExceptionHandler java code -->    
    <end-state id="error" />

    <!-- ================== -->
    <!-- GLOBAL TRANSITIONS -->
    <!-- ================== -->
	<global-transitions>
        <!-- transitions -->    
		<transition on="select" to="accountSelected" validate="false">
			<set name="flowScope.accountSelected" value="accounts.selectedRow" />
		</transition>
		<transition on="cancel" to="cancel" validate="false" />
		<transition on="sendNew" to="new" validate="false" />
		<transition on="quit" to="quit" validate="false" />

        <!-- testing errors -->
        <transition on="ajaxDebugThrowException">
            <evaluate expression="exceptionUtil.throwRuntimeException()" />
        </transition>
        <transition on="debugThrowException" to="startChoice">
            <evaluate expression="exceptionUtil.throwRuntimeException()" />
        </transition>
	</global-transitions>
    
    <!-- ========== -->
    <!-- EXCEPTIONS -->
    <!-- ========== -->
    <exception-handler bean="simpleExceptionHandler"/>    
</flow>